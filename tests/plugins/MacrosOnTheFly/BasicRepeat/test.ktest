VERSION 1

KEYSWITCH A 0 0
KEYSWITCH B 0 1
KEYSWITCH J 1 0
KEYSWITCH MACROREC   0 7
KEYSWITCH MACROPLAY  1 7
KEYSWITCH MACRODELAY 2 7

# ==============================================================================
# MacrosOnTheFly can record and replay something.
NAME MacrosOnTheFly basic record and replay

# .........................................................................
# Should not affect standard typing (it did very early on).

RUN 10 ms

PRESS A
RUN 1 cycle
EXPECT keyboard-report Key_A # Report should contain only `A`
RUN 1 cycle
RELEASE A
RUN 1 cycle
EXPECT keyboard-report empty # Report should be empty
RUN 1 cycle
RUN 5 ms

PRESS B
RUN 1 cycle
EXPECT keyboard-report Key_B # Report should contain only `B`
RUN 1 cycle
RELEASE B
RUN 1 cycle
EXPECT keyboard-report empty # Report should be empty
RUN 1 cycle
RUN 5 ms

PRESS J
RUN 1 cycle
EXPECT keyboard-report Key_J # Report should contain only `J`
RUN 1 cycle
RELEASE J
RUN 1 cycle
EXPECT keyboard-report empty # Report should be empty
RUN 1 cycle
RUN 5 ms

# .........................................................................
# Record behaves as expected.

PRESS MACROREC
RUN 1 cycle
EXPECT no keyboard-report
RELEASE MACROREC
RUN 1 cycle
EXPECT no keyboard-report
PRESS A
RUN 1 cycle
EXPECT no keyboard-report
RELEASE A
RUN 1 cycle
EXPECT no keyboard-report
PRESS J
RUN 1 cycle
EXPECT keyboard-report Key_J # Should report while recording macro.
RELEASE J
RUN 1 cycle
EXPECT keyboard-report empty # Report should be empty
PRESS MACROREC
RUN 1 cycle
EXPECT no keyboard-report
RELEASE MACROREC
RUN 1 ms

PRESS MACROREC
RUN 1 cycle
EXPECT no keyboard-report
RELEASE MACROREC
RUN 1 cycle
EXPECT no keyboard-report
PRESS B
RUN 1 cycle
EXPECT no keyboard-report
RELEASE B
RUN 1 cycle
EXPECT no keyboard-report
PRESS B
RUN 1 cycle
EXPECT keyboard-report Key_B # Should report while recording macro.
RELEASE B
RUN 1 cycle
EXPECT keyboard-report empty # Report should be empty
PRESS MACROREC
RUN 1 cycle
EXPECT no keyboard-report
RELEASE MACROREC
RUN 1 ms

# .........................................................................
# Replay behaves as expected.
PRESS MACROPLAY
RUN 1 cycle
EXPECT no keyboard-report
RUN 1 cycle
RELEASE MACROPLAY
RUN 1 cycle
PRESS B
RUN 1 cycle
EXPECT keyboard-report Key_B # Should report the macro.
EXPECT keyboard-report empty # Report should be empty
RUN 1 cycle
RELEASE B
RUN 1 cycle
EXPECT no keyboard-report

PRESS MACROPLAY
RUN 1 cycle
EXPECT no keyboard-report
RUN 1 cycle
RELEASE MACROPLAY
RUN 1 cycle
PRESS MACROPLAY
RUN 1 cycle
EXPECT keyboard-report Key_B # Should report the macro.
EXPECT keyboard-report empty # Report should be empty
RUN 1 cycle
RELEASE MACROPLAY
RUN 1 cycle
EXPECT no keyboard-report

PRESS MACROPLAY
RUN 1 cycle
EXPECT no keyboard-report
RUN 1 cycle
RELEASE MACROPLAY
RUN 1 cycle
PRESS A
RUN 1 cycle
EXPECT keyboard-report Key_J # Should report the macro.
EXPECT keyboard-report empty # Report should be empty
RUN 1 cycle
RELEASE A
RUN 1 cycle
EXPECT no keyboard-report

# .........................................................................
# Can "zero out" a macro.

PRESS MACROREC
RUN 1 cycle
EXPECT no keyboard-report
RELEASE MACROREC
RUN 1 cycle
EXPECT no keyboard-report
PRESS A
RUN 1 cycle
EXPECT no keyboard-report
RELEASE A
RUN 1 cycle
EXPECT no keyboard-report
PRESS MACROREC
RUN 1 cycle
RELEASE MACROREC
RUN 1 ms

PRESS MACROPLAY
RUN 1 cycle
EXPECT no keyboard-report
RUN 1 cycle
RELEASE MACROPLAY
RUN 1 cycle
PRESS A
RUN 1 cycle
EXPECT no keyboard-report
RUN 1 cycle
RELEASE A
RUN 1 cycle
EXPECT no keyboard-report

# .........................................................................
# Do not need to release MACROREC before pressing the macro recording key.

PRESS MACROREC
RUN 1 cycle
EXPECT no keyboard-report
PRESS A
RUN 1 cycle
EXPECT no keyboard-report
RELEASE A
RUN 1 cycle
EXPECT no keyboard-report
RELEASE MACROREC
RUN 1 cycle
EXPECT no keyboard-report
PRESS J
RUN 1 cycle
EXPECT keyboard-report Key_J # Should report while recording macro.
RELEASE J
RUN 1 cycle
EXPECT keyboard-report empty # Report should be empty
PRESS MACROREC
RUN 1 cycle
EXPECT no keyboard-report
RELEASE MACROREC
RUN 1 ms

PRESS MACROPLAY
RUN 1 cycle
EXPECT no keyboard-report
RUN 1 cycle
RELEASE MACROPLAY
RUN 1 cycle
PRESS A
RUN 1 cycle
EXPECT keyboard-report Key_J # Should report the macro.
EXPECT keyboard-report empty # Report should be empty
RUN 1 cycle
RELEASE A
RUN 1 cycle
EXPECT no keyboard-report
